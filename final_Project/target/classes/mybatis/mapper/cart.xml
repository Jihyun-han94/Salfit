<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="cartMapper">
	<select id="yselectAll" parameterType="cart" resultType="cart">
	 SELECT * 
	 FROM cart
	 WHERE aid =#{aid} AND orderstate='y'
	</select>
	<select id="select" parameterType="cart" resultType="cart">
			SELECT c.id
			,c.aid
			,c.pid
			,c.qty
			,c.orderstate
			,p.price AS price
			,p.title AS title
			,(price*c.qty) money
		FROM cart c
		JOIN account a
		  ON c.aid = a.id
		JOIN product p
		  ON c.pid = p.id
		WHERE c.id = #{id} 
		ORDER BY c.id DESC
	</select>

	<update id="update">
	UPDATE CART
	SET ORDERSTATE = 'y'
	where ORDERSTATE = 'n'
	</update>


	<!-- 장바구니 담기 버튼 클릭하면 실행되는 쿼리문 -->
	<insert id="insert">
		INSERT INTO cart(id,aid,pid,qty)
		VALUES (cart_seq.NEXTVAL, #{aid}, #{pid},#{qty})
	</insert>
	
	<!-- cart.aid로 장바구니 조회 -->
	<select id="selectAll" parameterType="cart" resultType="cart">
		SELECT c.id
			,c.aid
			,c.pid
			,c.qty
			,c.orderstate
			,a.email AS email
			,p.price AS price
			,p.title AS title
			,(price*c.qty) money
			
		FROM cart c
		JOIN account a
		  ON c.aid = a.id
		JOIN product p
		  ON c.pid = p.id
		WHERE c.aid = #{aid} AND orderstate = 'n'
		ORDER BY c.id DESC
	
	</select>
	<select id="sumMoney" parameterType="cart" resultType="_int">
		SELECT nvl(sum(p.price*c.qty),0)
		FROM cart c
		JOIN product p
		  on c.pid = p.id
		WHERE c.aid = #{aid}
		ORDER BY c.id DESC  
	
	</select>
	<delete id="deleteCart">
     DELETE cart
     where id = #{id}
     </delete>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="orderMapper">
	<!-- 수정필요 -->

	<select id="selectall" parameterType="orderdetail" resultType="orderdetail">
		SELECT  d.id
	        	,d.oid 
	        	,d.pid 
	        	,d.qty 
	        	,d.price 
	        	,d.status
	        	,d.startdate
	        	,d.enddate
	        	,d.days
	        	,d.status
	        	,p.title
		FROM order_detail d  
		JOIN product p
		ON d.pid = p.id
		WHERE d.oid = #{oid} 
	</select>
	
	<select id ="selectList" parameterType="order" resultType="order" >
		SELECT *
		FROM ordered  
		WHERE aid = #{aid}
	</select>
	
	 <insert id="insertordered" parameterType="order">
	  	INSERT INTO ordered(id, aid, receiver, address, paytype, total, pdate, ddate, edate)
	  	     VALUES(ordered_seq.NEXTVAL, #{aid}, #{receiver}, #{address}, #{paytype}, #{total}, to_char(sysdate, 'yyyy-mm-dd'), #{ddate}, #{edate})
	 </insert> 
	
	<select id="selectone" parameterType="order" resultType="order">
		SELECT *
		FROM (
	        SELECT*
	        FROM ORDERED
	        ORDER BY ROWNUM DESC
		)
		WHERE ROWNUM = 1 AND aid = #{aid} AND pdate = to_char(sysdate, 'yyyy-mm-dd')
	</select>	
	
	<insert id="insertorderdetail" parameterType="orderdetail">
		INSERT INTO ORDER_DETAIL (id,oid,pid,qty,price,startdate,enddate,days)
		VALUES (order_detail_seq.NEXTVAL, #{oid},#{pid},#{qty},#{price},#{startdate},#{enddate},#{days})
	</insert>
</mapper>